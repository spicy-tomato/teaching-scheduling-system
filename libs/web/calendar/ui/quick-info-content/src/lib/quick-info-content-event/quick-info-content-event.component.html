<div *ngIf="data.StartTime && data.EndTime" class="e-date-time">
  <div class="e-date-time-icon e-icons"></div>
  <div class="e-date-time-wrapper e-text-ellipsis">
    <div class="e-date-time-details e-text-ellipsis">
      {{ data.StartTime | calendarDateTime: data.EndTime }}
    </div>
  </div>
</div>
<div *ngIf="data.Location" class="e-location">
  <div class="e-location-icon e-icons"></div>
  <div class="e-location-details e-text-ellipsis">
    {{ data.Location }}
  </div>
</div>
<div *ngIf="data.IdModuleClass" class="e-module-class">
  <div class="mdi mdi-book-open-variant"></div>
  <div class="e-location-details e-text-ellipsis">
    {{ data.IdModuleClass }}
  </div>
</div>
<div *ngIf="data.Method" class="e-module-class">
  <div class="mdi mdi-bullseye-arrow"></div>
  <div class="e-location-details e-text-ellipsis">
    {{ data.Method }}
  </div>
</div>
<ng-container *ngIf="data.FixedSchedules && data.FixedSchedules.length > 0">
  <ng-container
    *tssVar="
      data.FixedSchedules[data.FixedSchedules.length - 1] as lastFixedSchedule
    "
  >
    <ng-container
      *tssVar="
        lastFixedSchedule.newDate === null ||
        !!lastFixedSchedule.intendTime as isIntendTime
      "
    >
      <ng-container
        *tssVar="
          lastFixedSchedule.status | changeStatusType as changeStatusType
        "
      >
        <div
          *ngIf="
            changeStatusType === 'pending' || changeStatusType === 'approve'
          "
          class="e-module-class"
        >
          <div class="mdi mdi-swap-horizontal-bold"></div>
          <div class="e-location-details e-text-ellipsis">
            <p [ngSwitch]="true">
              <ng-container
                *ngSwitchCase="!isIntendTime && changeStatusType === 'pending'"
              >
                Đang được yêu cầu đổi đến ca
                {{ lastFixedSchedule.newShift }}, ngày
                {{ lastFixedSchedule.newDate | date: 'longDate':'+0700' }}
                {{
                  lastFixedSchedule.newIdRoom
                    ? ' tại ' + lastFixedSchedule.newIdRoom
                    : ''
                }}
              </ng-container>
              <ng-container
                *ngSwitchCase="!isIntendTime && changeStatusType === 'approve'"
              >
                Đổi từ ca {{ lastFixedSchedule.oldShift }}, ngày
                {{ lastFixedSchedule.oldDate | date: 'longDate':'+0700' }}
              </ng-container>
              <ng-container
                *ngSwitchCase="isIntendTime && changeStatusType === 'pending'"
              >
                Đang được yêu cầu đổi đến
                {{ lastFixedSchedule.intendTime }}
              </ng-container>
              <ng-container
                *ngSwitchCase="isIntendTime && changeStatusType === 'approve'"
              >
                Dự định dạy trong
                {{ lastFixedSchedule.intendTime }}
              </ng-container>
              <button
                tuiLink
                [pseudo]="true"
                (click)="onShowHistory()"
                class="inline-block ml-0.5 pr-0.5 italic"
              >
                Chi tiết
              </button>
            </p>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>
<!-- TODO: remove any -->
<ng-container *ngIf="data.People">
  <div
    *ngFor="let person of $any(data.People) | tuiFilter: peopleMatcher"
    class="e-module-class"
  >
    <div class="mdi mdi-account"></div>
    <div class="e-location-details e-text-ellipsis">
      {{ $any(person).name || person }}
    </div>
  </div>
</ng-container>
<div class="e-module-class">
  <div class="mdi mdi-note-edit pt-2"></div>
  <div class="flex-grow">
    <tui-text-area
      #note
      [(ngModel)]="data.Note"
      [expandable]="true"
      [rows]="3"
      [tuiTextfieldLabelOutside]="true"
      (ngModelChange)="onNoteChange()"
      tuiTextfieldSize="m"
      class="!min-h-[2.4375rem]"
    >
      Nhập ghi chú
    </tui-text-area>
  </div>
</div>
<div class="flex justify-end mt-3">
  <button
    tuiButton
    *ngrxLet="status$ as status"
    [showLoader]="status === 'loading'"
    [disabled]="data.Note === initialEventNote"
    (click)="onClickSave()"
  >
    Lưu
  </button>
</div>
